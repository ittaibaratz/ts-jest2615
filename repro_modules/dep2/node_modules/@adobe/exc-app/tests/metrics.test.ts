/*************************************************************************
 * Copyright 2020 Adobe
 * All Rights Reserved.
 *
 * NOTICE: Adobe permits you to use, modify, and distribute this file in
 * accordance with the terms of the Adobe license agreement accompanying
 * it. If you have received this file from a source other than Adobe,
 * then your use, modification, or distribution of it requires the prior
 * written permission of Adobe.
 **************************************************************************/
import Global, {Modules} from '../src/Global';
import metrics, {Metrics} from '../metrics';

describe('metrics/index.js', () => {
  const expectedInstance = {} as Metrics;
  beforeEach(() => {
    (Global['exc-module-runtime'] as Modules) = {
      metrics: {
        create: name => {
          console.log(name); // eslint-disable-line no-console
          return expectedInstance;
        }
      }
    } as Modules;
  });

  it('correctly sets up the connection with module-runtime', () => {
    const createSpy = jest.spyOn(Global['exc-module-runtime'].metrics, 'create');
    const actualInstance = metrics.create('component_name');
    expect(createSpy).toBeCalledTimes(1);
    expect(createSpy).toBeCalledWith('component_name');
    expect(actualInstance).toBe(expectedInstance);
  });
});
