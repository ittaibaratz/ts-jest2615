/*************************************************************************
 * Copyright 2020 Adobe
 * All Rights Reserved.
 *
 * NOTICE: Adobe permits you to use, modify, and distribute this file in
 * accordance with the terms of the Adobe license agreement accompanying
 * it. If you have received this file from a source other than Adobe,
 * then your use, modification, or distribution of it requires the prior
 * written permission of Adobe.
 **************************************************************************/
import Global, {Modules} from '../src/Global';
import pulse, {PulseApi, PulseNotification, PulseResponse} from '../pulse';

describe('pulse.ts', () => {
  it('correctly sets up the connection with module-runtime', () => {
    // setup
    const pulseMock = {
      send: () => Promise.resolve<PulseResponse>({notifications: {notification: []}})
    } as PulseApi;
    (Global['exc-module-runtime'] as Modules) = {
      pulse: () => {
        return pulseMock;
      }
    } as Modules;
    const sendSpy = jest.spyOn(pulseMock, 'send');
    const expected = [{} as PulseNotification];

    // action
    pulse.send(expected);

    // verify
    expect(sendSpy).toBeCalledTimes(1);
    expect(sendSpy).toBeCalledWith(expected);
  });
});
