/*************************************************************************
 * Copyright 2020 Adobe
 * All Rights Reserved.
 *
 * NOTICE: Adobe permits you to use, modify, and distribute this file in
 * accordance with the terms of the Adobe license agreement accompanying
 * it. If you have received this file from a source other than Adobe,
 * then your use, modification, or distribution of it requires the prior
 * written permission of Adobe.
 **************************************************************************/
import appapi, {AppIds} from '../appapi';
import Global, {Modules} from '../src/Global';

describe('appapi', () => {
  beforeEach(() => {
    (Global['exc-module-runtime'] as Modules) = {
      appApi: () => {
        return {
          get: (type) => {
            if (type === 'analytics') {
              return {
                adobeBrandType: 'application',
                appId: 'analytics',
                description: 'Collect, organize, analyze and report on everything your customers do',
                enabled: false,
                functionalIconReact: 'DataAnalytics',
                functionalIconUrl: 'https://exc-unifiedcontent.experience-stage.adobe.net/assets/BrandIcons.33cbb3cf.svg#DataAnalytics',
                href: 'https://app-discovery-qe.corp.ethos11-stage-or1.ethos.adobe.net/1.0/loginRedirect?allow_project_redirect=1&IMS=1',
                icon: 'adobeAnalytics',
                iconReact: 'AdobeAnalytics',
                iconUrl: '',
                learnMoreLink: 'http://www.adobe.com/marketing-cloud/web-analytics.html',
                longName: 'Adobe Analytics',
                name: 'Analytics',
                settingsAppId: 'analytics',
                visible: false
              };
            }
            if (type === 'target') {
              return {
                adobeBrandType: 'application',
                appId: 'target',
                description: 'Use experimentation, testing and machine learning automation to deliver the best content to each visitor',
                enabled: false,
                functionalIconReact: 'ContentProfile',
                functionalIconUrl: 'https://exc-unifiedcontent.experience-stage.adobe.net/assets/BrandIcons.33cbb3cf.svg#ContentProfile',
                href: 'https://experience-stage.adobe.com/#/target',
                icon: 'adobeTarget',
                iconReact: 'AdobeTarget',
                iconUrl: '',
                learnMoreLink: 'https://www.adobe.com/marketing/target.html',
                longName: 'Adobe Target',
                name: 'Target',
                settingsAppId: '',
                visible: false
              };
            }
            return {};
          }
        };
      }
    } as Modules;
  });

  test('get', async () => {
    const analytics = await appapi.get(AppIds.ANALYTICS);
    const target = await appapi.get(AppIds.TARGET);
    expect(analytics.appId).toBe('analytics');
    expect(analytics.enabled).toBe(false);
    expect(analytics.functionalIconUrl).toBe('https://exc-unifiedcontent.experience-stage.adobe.net/assets/BrandIcons.33cbb3cf.svg#DataAnalytics');
    expect(analytics.href).toBe('https://app-discovery-qe.corp.ethos11-stage-or1.ethos.adobe.net/1.0/loginRedirect?allow_project_redirect=1&IMS=1');

    expect(target.appId).toBe('target');
    expect(target.enabled).toBe(false);
    expect(target.functionalIconUrl).toBe('https://exc-unifiedcontent.experience-stage.adobe.net/assets/BrandIcons.33cbb3cf.svg#ContentProfile');
    expect(target.href).toBe('https://experience-stage.adobe.com/#/target');
  });
});
